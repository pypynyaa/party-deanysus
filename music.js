// –ñ–¥–µ–º, –ø–æ–∫–∞ DOM –±—É–¥–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≥—Ä—É–∂–µ–Ω
document.addEventListener('DOMContentLoaded', function() {
    const audio = document.getElementById('background-music');
    const musicBtn = document.querySelector('.music-control');
    let isPlaying = localStorage.getItem('musicPlaying') === 'true';

    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏
    updateButtonState();

    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Ä–µ–º—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    const savedTime = localStorage.getItem('musicTime');
    if (savedTime) {
        audio.currentTime = parseFloat(savedTime);
    }

    // –ï—Å–ª–∏ –º—É–∑—ã–∫–∞ –¥–æ–ª–∂–Ω–∞ –∏–≥—Ä–∞—Ç—å, –ø—ã—Ç–∞–µ–º—Å—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏
    if (isPlaying) {
        const playPromise = audio.play();
        if (playPromise !== undefined) {
            playPromise.catch(error => {
                console.log('–ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ:', error);
                isPlaying = false;
                updateButtonState();
            });
        }
    }

    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏
    function updateButtonState() {
        musicBtn.textContent = isPlaying ? 'üéµ –í—ã–∫–ª—é—á–∏—Ç—å –º—É–∑—ã–∫—É' : 'üéµ –í–∫–ª—é—á–∏—Ç—å –º—É–∑—ã–∫—É';
        localStorage.setItem('musicPlaying', isPlaying);
    }

    // –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º—É–∑—ã–∫–∏
    window.toggleMusic = function() {
        if (isPlaying) {
            audio.pause();
        } else {
            const playPromise = audio.play();
            if (playPromise !== undefined) {
                playPromise.catch(error => {
                    console.log('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:', error);
                });
            }
        }
        isPlaying = !isPlaying;
        updateButtonState();
    };

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
    setInterval(() => {
        if (isPlaying) {
            localStorage.setItem('musicTime', audio.currentTime);
        }
    }, 1000);

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏—è –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ç—Ä–µ–∫–∞
    audio.addEventListener('ended', function() {
        if (isPlaying) {
            audio.currentTime = 0;
            audio.play().catch(e => console.log('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:', e));
        }
    });

    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≥—Ä–æ–º–∫–æ—Å—Ç—å
    audio.volume = 0.7;
}); 